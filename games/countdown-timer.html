<!-- games/countdown-timer.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Countdown Timer - TickleBox</title>
    <link rel="stylesheet" href="../css/ticklebox-styles.css" />
    <link rel="stylesheet" href="../css/ticklebox-animations.css" />
    <style>
      .ticklebox-countdown-container {
        max-width: 800px;
        margin: 0 auto;
      }

      .ticklebox-countdown-setup {
        background: var(--ticklebox-bg-card);
        border-radius: var(--ticklebox-radius-lg);
        padding: var(--ticklebox-space-xl);
        margin: var(--ticklebox-space-lg) 0;
      }

      .ticklebox-countdown-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--ticklebox-space);
        margin: var(--ticklebox-space) 0;
      }

      .ticklebox-countdown-input-group {
        margin-bottom: var(--ticklebox-space);
      }

      .ticklebox-countdown-label {
        display: block;
        margin-bottom: var(--ticklebox-space-xs);
        color: var(--ticklebox-text-secondary);
        font-weight: 500;
      }

      .ticklebox-countdown-input {
        width: 100%;
        padding: var(--ticklebox-space);
        border: 2px solid var(--ticklebox-border);
        border-radius: var(--ticklebox-radius);
        background: var(--ticklebox-bg-secondary);
        color: var(--ticklebox-text-primary);
        font-size: 1rem;
      }

      .ticklebox-countdown-input:focus {
        outline: none;
        border-color: var(--ticklebox-primary);
      }

      .ticklebox-countdown-display {
        background: linear-gradient(
          135deg,
          var(--ticklebox-primary-light),
          var(--ticklebox-secondary-light)
        );
        border-radius: var(--ticklebox-radius-lg);
        padding: var(--ticklebox-space-xl);
        margin: var(--ticklebox-space-lg) 0;
        color: white;
        text-align: center;
        display: none;
      }

      .ticklebox-countdown-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: var(--ticklebox-space);
      }

      .ticklebox-countdown-timer {
        font-size: 4rem;
        font-weight: 700;
        margin: var(--ticklebox-space) 0;
        font-family: monospace;
        letter-spacing: 2px;
      }

      .ticklebox-countdown-units {
        display: flex;
        justify-content: center;
        gap: var(--ticklebox-space-xl);
        margin: var(--ticklebox-space) 0;
      }

      .ticklebox-countdown-unit {
        text-align: center;
      }

      .ticklebox-countdown-unit-value {
        font-size: 3rem;
        font-weight: 700;
        line-height: 1;
      }

      .ticklebox-countdown-unit-label {
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        opacity: 0.9;
      }

      .ticklebox-countdown-progress {
        height: 8px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        margin: var(--ticklebox-space) 0;
        overflow: hidden;
      }

      .ticklebox-countdown-progress-fill {
        height: 100%;
        background: white;
        border-radius: 4px;
        transition: width 1s linear;
      }

      .ticklebox-countdown-actions {
        display: flex;
        gap: var(--ticklebox-space);
        justify-content: center;
        margin-top: var(--ticklebox-space);
      }

      .ticklebox-countdown-btn {
        padding: var(--ticklebox-space-sm) var(--ticklebox-space-lg);
        border: none;
        border-radius: var(--ticklebox-radius);
        font-weight: 600;
        cursor: pointer;
        transition: all var(--ticklebox-transition-fast);
        display: flex;
        align-items: center;
        gap: var(--ticklebox-space-xs);
      }

      .ticklebox-countdown-btn-primary {
        background: white;
        color: var(--ticklebox-primary);
      }

      .ticklebox-countdown-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--ticklebox-shadow-lg);
      }

      .ticklebox-countdown-btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
      }

      .ticklebox-countdown-btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .ticklebox-countdown-presets {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: var(--ticklebox-space);
        margin: var(--ticklebox-space) 0;
      }

      .ticklebox-countdown-preset {
        padding: var(--ticklebox-space);
        background: var(--ticklebox-bg-secondary);
        border: 2px solid var(--ticklebox-border);
        border-radius: var(--ticklebox-radius);
        text-align: center;
        cursor: pointer;
        transition: all var(--ticklebox-transition-fast);
      }

      .ticklebox-countdown-preset:hover {
        border-color: var(--ticklebox-primary);
        transform: translateY(-2px);
      }

      .ticklebox-countdown-preset-icon {
        font-size: 2rem;
        margin-bottom: var(--ticklebox-space-sm);
      }

      .ticklebox-countdown-preset-title {
        font-weight: 600;
        margin-bottom: var(--ticklebox-space-xs);
      }

      .ticklebox-countdown-preset-time {
        font-size: 0.875rem;
        color: var(--ticklebox-text-tertiary);
      }

      .ticklebox-countdown-alarm {
        margin-top: var(--ticklebox-space-lg);
        padding-top: var(--ticklebox-space);
        border-top: 1px solid var(--ticklebox-border);
      }

      .ticklebox-countdown-alarm-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: var(--ticklebox-space-sm);
        margin: var(--ticklebox-space) 0;
      }

      .ticklebox-countdown-alarm-option {
        padding: var(--ticklebox-space-sm);
        background: var(--ticklebox-bg-secondary);
        border: 2px solid var(--ticklebox-border);
        border-radius: var(--ticklebox-radius);
        text-align: center;
        cursor: pointer;
        transition: all var(--ticklebox-transition-fast);
      }

      .ticklebox-countdown-alarm-option:hover {
        border-color: var(--ticklebox-primary);
      }

      .ticklebox-countdown-alarm-option.active {
        border-color: var(--ticklebox-primary);
        background: var(--ticklebox-primary);
        color: white;
      }

      .ticklebox-countdown-alarm-icon {
        font-size: 1.5rem;
        margin-bottom: var(--ticklebox-space-xs);
      }

      .ticklebox-countdown-alarm-label {
        font-size: 0.875rem;
      }

      .ticklebox-countdown-message {
        margin-top: var(--ticklebox-space);
        padding: var(--ticklebox-space);
        background: var(--ticklebox-bg-secondary);
        border-radius: var(--ticklebox-radius);
        font-style: italic;
        color: var(--ticklebox-text-secondary);
        text-align: center;
      }

      .ticklebox-countdown-complete {
        background: linear-gradient(135deg, #f59e0b, #ef4444);
        border-radius: var(--ticklebox-radius-lg);
        padding: var(--ticklebox-space-xl);
        margin: var(--ticklebox-space-lg) 0;
        color: white;
        text-align: center;
        display: none;
        animation: ticklebox-pulse 2s infinite;
      }

      .ticklebox-countdown-complete-icon {
        font-size: 4rem;
        margin-bottom: var(--ticklebox-space);
      }

      .ticklebox-countdown-complete-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: var(--ticklebox-space);
      }

      .ticklebox-countdown-complete-message {
        font-size: 1.2rem;
        margin-bottom: var(--ticklebox-space-lg);
        line-height: 1.6;
      }

      .ticklebox-countdown-share {
        margin-top: var(--ticklebox-space-lg);
        padding: var(--ticklebox-space);
        background: rgba(255, 255, 255, 0.1);
        border-radius: var(--ticklebox-radius);
      }

      .ticklebox-countdown-reminder {
        display: flex;
        align-items: center;
        gap: var(--ticklebox-space);
        margin: var(--ticklebox-space) 0;
        padding: var(--ticklebox-space-sm);
        background: var(--ticklebox-bg-secondary);
        border-radius: var(--ticklebox-radius);
      }

      .ticklebox-countdown-reminder-input {
        flex: 1;
        padding: var(--ticklebox-space-sm);
        border: 2px solid var(--ticklebox-border);
        border-radius: var(--ticklebox-radius);
        background: var(--ticklebox-bg-primary);
        color: var(--ticklebox-text-primary);
      }
    </style>
  </head>
  <body>
    <!-- components/navbar.html - FIXED VERSION -->



    <div id="tickleboxNavbarContainer"></div>

    <main class="ticklebox-container">
      <div class="ticklebox-game-header">
        <div class="ticklebox-game-header-icon">‚è∞</div>
        <div class="ticklebox-game-header-info">
          <h1 class="ticklebox-game-title">Countdown Timer</h1>
          <p class="ticklebox-game-subtitle">
            Countdown to special events and anniversaries
          </p>
          <div class="ticklebox-game-meta">
            <span class="ticklebox-game-rating">‚≠ê 4.8 (900K+ plays)</span>
            <span class="ticklebox-game-category">üìÖ Utility</span>
            <span class="ticklebox-game-time">‚è±Ô∏è Custom</span>
          </div>
        </div>
        <button class="ticklebox-game-share" id="tickleboxCountdownShare">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path
              fill="currentColor"
              d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"
            />
          </svg>
          Share
        </button>
      </div>

      <div class="ticklebox-game-content">
        <div class="ticklebox-countdown-container">
          <div class="ticklebox-countdown-setup">
            <h2 class="ticklebox-section-title">Create Your Countdown</h2>
            <p class="ticklebox-section-subtitle">
              Set a timer for any special occasion
            </p>

            <div class="ticklebox-countdown-inputs">
              <div class="ticklebox-countdown-input-group">
                <label class="ticklebox-countdown-label">Event Name</label>
                <input
                  type="text"
                  class="ticklebox-countdown-input"
                  id="tickleboxEventName"
                  placeholder="e.g., Anniversary, Birthday, Vacation"
                  value="Special Event"
                />
              </div>

              <div class="ticklebox-countdown-input-group">
                <label class="ticklebox-countdown-label"
                  >Target Date & Time</label
                >
                <input
                  type="datetime-local"
                  class="ticklebox-countdown-input"
                  id="tickleboxTargetDateTime"
                  value=""
                />
              </div>
            </div>

            <h3
              class="ticklebox-section-title"
              style="margin-top: var(--ticklebox-space-lg)"
            >
              Quick Presets
            </h3>
            <div
              class="ticklebox-countdown-presets"
              id="tickleboxCountdownPresets"
            >
              <!-- Presets will be loaded by JavaScript -->
            </div>

            <div class="ticklebox-countdown-alarm">
              <h3 class="ticklebox-section-title">Alarm Sound</h3>
              <div
                class="ticklebox-countdown-alarm-options"
                id="tickleboxAlarmOptions"
              >
                <!-- Alarm options will be loaded by JavaScript -->
              </div>
            </div>

            <div class="ticklebox-countdown-reminder">
              <input
                type="email"
                class="ticklebox-countdown-reminder-input"
                id="tickleboxReminderEmail"
                placeholder="Email for reminder (optional)"
              />
              <button
                class="ticklebox-countdown-btn ticklebox-countdown-btn-secondary"
              >
                Set Reminder
              </button>
            </div>

            <button
              class="ticklebox-btn-primary"
              id="tickleboxStartCountdown"
              style="width: 100%; margin-top: var(--ticklebox-space)"
            >
              üöÄ Start Countdown
            </button>
          </div>

          <div
            class="ticklebox-countdown-display"
            id="tickleboxCountdownDisplay"
          >
            <div class="ticklebox-countdown-title" id="tickleboxDisplayTitle">
              Special Event
            </div>
            <div class="ticklebox-countdown-timer" id="tickleboxDisplayTimer">
              00:00:00:00
            </div>

            <div class="ticklebox-countdown-units">
              <div class="ticklebox-countdown-unit">
                <div class="ticklebox-countdown-unit-value" id="tickleboxDays">
                  00
                </div>
                <div class="ticklebox-countdown-unit-label">Days</div>
              </div>
              <div class="ticklebox-countdown-unit">
                <div class="ticklebox-countdown-unit-value" id="tickleboxHours">
                  00
                </div>
                <div class="ticklebox-countdown-unit-label">Hours</div>
              </div>
              <div class="ticklebox-countdown-unit">
                <div
                  class="ticklebox-countdown-unit-value"
                  id="tickleboxMinutes"
                >
                  00
                </div>
                <div class="ticklebox-countdown-unit-label">Minutes</div>
              </div>
              <div class="ticklebox-countdown-unit">
                <div
                  class="ticklebox-countdown-unit-value"
                  id="tickleboxSeconds"
                >
                  00
                </div>
                <div class="ticklebox-countdown-unit-label">Seconds</div>
              </div>
            </div>

            <div class="ticklebox-countdown-progress">
              <div
                class="ticklebox-countdown-progress-fill"
                id="tickleboxCountdownProgress"
                style="width: 0%"
              ></div>
            </div>

            <div
              class="ticklebox-countdown-message"
              id="tickleboxCountdownMessage"
            >
              The countdown is on! Share it with friends and family.
            </div>

            <div class="ticklebox-countdown-actions">
              <button
                class="ticklebox-countdown-btn ticklebox-countdown-btn-secondary"
                id="tickleboxPauseCountdown"
              >
                ‚è∏Ô∏è Pause
              </button>
              <button
                class="ticklebox-countdown-btn ticklebox-countdown-btn-primary"
                id="tickleboxShareCountdown"
              >
                üì§ Share
              </button>
              <button
                class="ticklebox-countdown-btn ticklebox-countdown-btn-secondary"
                id="tickleboxResetCountdown"
              >
                üîÑ Reset
              </button>
            </div>

            <div class="ticklebox-countdown-share" id="tickleboxShareSection">
              <h3 style="margin-bottom: var(--ticklebox-space-sm)">
                Share Your Countdown
              </h3>
              <div class="ticklebox-share-options">
                <a
                  href="#"
                  class="ticklebox-share-option"
                  data-platform="facebook"
                >
                  <svg class="ticklebox-share-icon" viewBox="0 0 24 24">
                    <path
                      fill="currentColor"
                      d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"
                    />
                  </svg>
                  <span class="ticklebox-share-label">Facebook</span>
                </a>
                <a
                  href="#"
                  class="ticklebox-share-option"
                  data-platform="twitter"
                >
                  <svg class="ticklebox-share-icon" viewBox="0 0 24 24">
                    <path
                      fill="currentColor"
                      d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"
                    />
                  </svg>
                  <span class="ticklebox-share-label">Twitter</span>
                </a>
                <a
                  href="#"
                  class="ticklebox-share-option"
                  data-platform="whatsapp"
                >
                  <svg class="ticklebox-share-icon" viewBox="0 0 24 24">
                    <path
                      fill="currentColor"
                      d="M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"
                    />
                  </svg>
                  <span class="ticklebox-share-label">WhatsApp</span>
                </a>
                <a href="#" class="ticklebox-share-option" data-platform="copy">
                  <svg class="ticklebox-share-icon" viewBox="0 0 24 24">
                    <path
                      fill="currentColor"
                      d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"
                    />
                  </svg>
                  <span class="ticklebox-share-label">Copy Link</span>
                </a>
              </div>
            </div>
          </div>

          <div
            class="ticklebox-countdown-complete"
            id="tickleboxCountdownComplete"
          >
            <!-- Completion screen will be shown here -->
          </div>
        </div>
      </div>
    </main>

   <!-- components/footer.html - FIXED VERSION -->

    <div id="tickleboxFooterContainer"></div>

    <script src="../js/ticklebox-main.js"></script>
    <script>
      // Preset data
      const TICKLEBOX_COUNTDOWN_PRESETS = [
        {
          name: "New Year",
          icon: "üéÜ",
          time: "1 hour",
          date: new Date(new Date().getFullYear() + 1, 0, 1, 0, 0, 0),
        },
        {
          name: "Birthday",
          icon: "üéÇ",
          time: "24 hours",
          date: new Date(
            new Date().getFullYear(),
            new Date().getMonth(),
            new Date().getDate() + 1,
            0,
            0,
            0,
          ),
        },
        {
          name: "Anniversary",
          icon: "üíù",
          time: "7 days",
          date: new Date(
            new Date().getFullYear(),
            new Date().getMonth(),
            new Date().getDate() + 7,
            18,
            0,
            0,
          ),
        },
        {
          name: "Vacation",
          icon: "üèñÔ∏è",
          time: "30 days",
          date: new Date(
            new Date().getFullYear(),
            new Date().getMonth() + 1,
            new Date().getDate(),
            0,
            0,
            0,
          ),
        },
        {
          name: "Exam",
          icon: "üìö",
          time: "2 hours",
          date: new Date(
            new Date().getFullYear(),
            new Date().getMonth(),
            new Date().getDate(),
            new Date().getHours() + 2,
            0,
            0,
          ),
        },
        {
          name: "Date Night",
          icon: "üåπ",
          time: "3 hours",
          date: new Date(
            new Date().getFullYear(),
            new Date().getMonth(),
            new Date().getDate(),
            new Date().getHours() + 3,
            0,
            0,
          ),
        },
      ];

      // Alarm sounds
      const TICKLEBOX_ALARM_SOUNDS = [
        {
          name: "Classic",
          icon: "‚è∞",
          url: "https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3",
        },
        {
          name: "Bell",
          icon: "üîî",
          url: "https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3",
        },
        {
          name: "Chime",
          icon: "üéµ",
          url: "https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3",
        },
        {
          name: "Celebration",
          icon: "üéâ",
          url: "https://assets.mixkit.co/sfx/preview/mixkit-winning-trumpet-2018.mp3",
        },
        { name: "No Sound", icon: "üîá", url: null },
      ];

      // Completion messages
      const TICKLEBOX_COMPLETION_MESSAGES = [
        "It's time! The moment you've been waiting for has arrived!",
        "The countdown is over! Your special moment is here!",
        "Time's up! Get ready for something amazing!",
        "The wait is over! Let the celebration begin!",
        "Your countdown has reached zero! The adventure starts now!",
      ];

      class TickleboxCountdownGame {
        constructor() {
          this.targetDate = null;
          this.eventName = "Special Event";
          this.alarmSound = TICKLEBOX_ALARM_SOUNDS[0];
          this.countdownInterval = null;
          this.isPaused = false;
          this.totalDuration = 0;
          this.elapsedTime = 0;
          this.audioContext = null;
          this.audioBuffer = null;
          this.init();
        }

        init() {
          this.setDefaultDateTime();
          this.loadPresets();
          this.loadAlarmOptions();
          this.setupEventListeners();
          this.setupAudio();
        }

        setDefaultDateTime() {
          // Set default to 1 hour from now
          const now = new Date();
          const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);

          // Format for datetime-local input (YYYY-MM-DDTHH:MM)
          const formatted = oneHourLater.toISOString().slice(0, 16);
          document.getElementById("tickleboxTargetDateTime").value = formatted;
        }

        loadPresets() {
          const presetsDiv = document.getElementById(
            "tickleboxCountdownPresets",
          );
          TICKLEBOX_COUNTDOWN_PRESETS.forEach((preset) => {
            const presetDiv = document.createElement("div");
            presetDiv.className = "ticklebox-countdown-preset";
            presetDiv.dataset.preset = preset.name.toLowerCase();
            presetDiv.innerHTML = `
                        <div class="ticklebox-countdown-preset-icon">${preset.icon}</div>
                        <div class="ticklebox-countdown-preset-title">${preset.name}</div>
                        <div class="ticklebox-countdown-preset-time">${preset.time}</div>
                    `;

            presetDiv.addEventListener("click", () => {
              this.applyPreset(preset);
            });

            presetsDiv.appendChild(presetDiv);
          });
        }

        loadAlarmOptions() {
          const alarmDiv = document.getElementById("tickleboxAlarmOptions");
          TICKLEBOX_ALARM_SOUNDS.forEach((sound) => {
            const alarmOption = document.createElement("div");
            alarmOption.className = "ticklebox-countdown-alarm-option";
            alarmOption.dataset.sound = sound.name.toLowerCase();
            if (sound.name === "Classic") {
              alarmOption.classList.add("active");
            }
            alarmOption.innerHTML = `
                        <div class="ticklebox-countdown-alarm-icon">${sound.icon}</div>
                        <div class="ticklebox-countdown-alarm-label">${sound.name}</div>
                    `;

            alarmOption.addEventListener("click", () => {
              this.selectAlarm(sound);
            });

            alarmDiv.appendChild(alarmOption);
          });
        }

        setupEventListeners() {
          // Start countdown
          document
            .getElementById("tickleboxStartCountdown")
            .addEventListener("click", () => {
              this.startCountdown();
            });

          // Control buttons
          document
            .getElementById("tickleboxPauseCountdown")
            .addEventListener("click", () => {
              this.togglePause();
            });

          document
            .getElementById("tickleboxResetCountdown")
            .addEventListener("click", () => {
              this.resetCountdown();
            });

          document
            .getElementById("tickleboxShareCountdown")
            .addEventListener("click", () => {
              this.shareCountdown();
            });

          // Share button in header
          document
            .getElementById("tickleboxCountdownShare")
            .addEventListener("click", () => {
              this.shareCountdown();
            });

          // Share options
          document
            .querySelectorAll("#tickleboxShareSection .ticklebox-share-option")
            .forEach((option) => {
              option.addEventListener("click", (e) => {
                e.preventDefault();
                const platform = option.dataset.platform;
                this.shareToPlatform(platform);
              });
            });
        }

        setupAudio() {
          try {
            this.audioContext = new (
              window.AudioContext || window.webkitAudioContext
            )();
          } catch (e) {
            console.log("Web Audio API not supported");
          }
        }

        applyPreset(preset) {
          // Set event name
          document.getElementById("tickleboxEventName").value = preset.name;

          // Set date and time
          const formatted = preset.date.toISOString().slice(0, 16);
          document.getElementById("tickleboxTargetDateTime").value = formatted;
        }

        selectAlarm(sound) {
          this.alarmSound = sound;

          // Update UI
          document
            .querySelectorAll(".ticklebox-countdown-alarm-option")
            .forEach((option) => {
              option.classList.remove("active");
            });
          document
            .querySelector(
              `.ticklebox-countdown-alarm-option[data-sound="${sound.name.toLowerCase()}"]`,
            )
            .classList.add("active");
        }

        startCountdown() {
          // Get values from inputs
          this.eventName =
            document.getElementById("tickleboxEventName").value ||
            "Special Event";
          const dateTimeInput = document.getElementById(
            "tickleboxTargetDateTime",
          ).value;

          if (!dateTimeInput) {
            alert("Please select a date and time");
            return;
          }

          this.targetDate = new Date(dateTimeInput);
          const now = new Date();

          if (this.targetDate <= now) {
            alert("Please select a future date and time");
            return;
          }

          // Calculate total duration
          this.totalDuration = this.targetDate - now;
          this.elapsedTime = 0;

          // Show countdown display
          document.getElementById("tickleboxCountdownDisplay").style.display =
            "block";
          document.getElementById("tickleboxCountdownComplete").style.display =
            "none";

          // Update title
          document.getElementById("tickleboxDisplayTitle").textContent =
            this.eventName;

          // Start countdown
          this.isPaused = false;
          this.updateCountdown();
          this.startTimer();

          // Scroll to countdown
          document
            .getElementById("tickleboxCountdownDisplay")
            .scrollIntoView({ behavior: "smooth" });
        }

        startTimer() {
          if (this.countdownInterval) {
            clearInterval(this.countdownInterval);
          }

          this.countdownInterval = setInterval(() => {
            if (!this.isPaused) {
              this.updateCountdown();
            }
          }, 1000);
        }

        updateCountdown() {
          const now = new Date();
          const timeRemaining = this.targetDate - now;

          if (timeRemaining <= 0) {
            this.completeCountdown();
            return;
          }

          // Update elapsed time
          this.elapsedTime = this.totalDuration - timeRemaining;

          // Calculate units
          const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
          );
          const minutes = Math.floor(
            (timeRemaining % (1000 * 60 * 60)) / (1000 * 60),
          );
          const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

          // Update display
          document.getElementById("tickleboxDays").textContent = days
            .toString()
            .padStart(2, "0");
          document.getElementById("tickleboxHours").textContent = hours
            .toString()
            .padStart(2, "0");
          document.getElementById("tickleboxMinutes").textContent = minutes
            .toString()
            .padStart(2, "0");
          document.getElementById("tickleboxSeconds").textContent = seconds
            .toString()
            .padStart(2, "0");

          // Update timer string
          document.getElementById("tickleboxDisplayTimer").textContent =
            `${days.toString().padStart(2, "0")}:${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          // Update progress
          const progressPercent = (this.elapsedTime / this.totalDuration) * 100;
          document.getElementById("tickleboxCountdownProgress").style.width =
            `${progressPercent}%`;

          // Update message based on time remaining
          this.updateCountdownMessage(timeRemaining);
        }

        updateCountdownMessage(timeRemaining) {
          const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
          );

          let message =
            "The countdown is on! Share it with friends and family.";

          if (days > 30) {
            message = `Only ${days} days to go! Get ready for ${this.eventName}!`;
          } else if (days > 7) {
            message = `Less than a month away! ${days} days until ${this.eventName}!`;
          } else if (days > 1) {
            message = `Just ${days} days left! The excitement is building!`;
          } else if (days === 1) {
            message = "Only 1 day remaining! Get ready for tomorrow!";
          } else if (hours > 12) {
            message = `Today's the day! ${hours} hours to go!`;
          } else if (hours > 1) {
            message = `Almost there! Only ${hours} hours remaining!`;
          } else if (hours === 1) {
            message = "Just 1 hour left! The final countdown begins!";
          } else {
            message = "Final minutes! Get ready for the big moment!";
          }

          document.getElementById("tickleboxCountdownMessage").textContent =
            message;
        }

        togglePause() {
          this.isPaused = !this.isPaused;
          const pauseBtn = document.getElementById("tickleboxPauseCountdown");

          if (this.isPaused) {
            pauseBtn.innerHTML = "‚ñ∂Ô∏è Resume";
            pauseBtn.classList.remove("ticklebox-countdown-btn-secondary");
            pauseBtn.classList.add("ticklebox-countdown-btn-primary");
          } else {
            pauseBtn.innerHTML = "‚è∏Ô∏è Pause";
            pauseBtn.classList.remove("ticklebox-countdown-btn-primary");
            pauseBtn.classList.add("ticklebox-countdown-btn-secondary");
          }
        }

        resetCountdown() {
          if (confirm("Are you sure you want to reset the countdown?")) {
            this.stopCountdown();
            document.getElementById("tickleboxCountdownDisplay").style.display =
              "none";
            document.getElementById(
              "tickleboxCountdownComplete",
            ).style.display = "none";

            // Scroll back to setup
            document
              .querySelector(".ticklebox-countdown-setup")
              .scrollIntoView({ behavior: "smooth" });
          }
        }

        stopCountdown() {
          if (this.countdownInterval) {
            clearInterval(this.countdownInterval);
            this.countdownInterval = null;
          }
          this.isPaused = false;
        }

        async completeCountdown() {
          this.stopCountdown();

          // Show completion screen
          document.getElementById("tickleboxCountdownDisplay").style.display =
            "none";
          const completeDiv = document.getElementById(
            "tickleboxCountdownComplete",
          );
          completeDiv.style.display = "block";

          // Random completion message
          const randomMessage =
            TICKLEBOX_COMPLETION_MESSAGES[
              Math.floor(Math.random() * TICKLEBOX_COMPLETION_MESSAGES.length)
            ];

          completeDiv.innerHTML = `
                    <div class="ticklebox-countdown-complete-icon">üéâ</div>
                    <div class="ticklebox-countdown-complete-title">${this.eventName} is Here!</div>
                    <div class="ticklebox-countdown-complete-message">${randomMessage}</div>
                    
                    <div class="ticklebox-countdown-actions">
                        <button class="ticklebox-countdown-btn ticklebox-countdown-btn-primary" id="tickleboxNewCountdown">
                            üéØ New Countdown
                        </button>
                        <button class="ticklebox-countdown-btn ticklebox-countdown-btn-secondary" id="tickleboxShareCompletion">
                            üì§ Share Celebration
                        </button>
                    </div>
                `;

          // Add event listeners
          document
            .getElementById("tickleboxNewCountdown")
            .addEventListener("click", () => {
              location.reload();
            });

          document
            .getElementById("tickleboxShareCompletion")
            .addEventListener("click", () => {
              this.shareCompletion();
            });

          // Play alarm sound
          if (this.alarmSound.url && this.audioContext) {
            await this.playAlarmSound();
          }

          // Scroll to completion
          completeDiv.scrollIntoView({ behavior: "smooth" });
        }

        async playAlarmSound() {
          try {
            const response = await fetch(this.alarmSound.url);
            const arrayBuffer = await response.arrayBuffer();
            this.audioBuffer =
              await this.audioContext.decodeAudioData(arrayBuffer);

            const source = this.audioContext.createBufferSource();
            source.buffer = this.audioBuffer;
            source.connect(this.audioContext.destination);
            source.start();

            // Play 3 times
            setTimeout(() => {
              const source2 = this.audioContext.createBufferSource();
              source2.buffer = this.audioBuffer;
              source2.connect(this.audioContext.destination);
              source2.start();
            }, 1000);

            setTimeout(() => {
              const source3 = this.audioContext.createBufferSource();
              source3.buffer = this.audioBuffer;
              source3.connect(this.audioContext.destination);
              source3.start();
            }, 2000);
          } catch (error) {
            console.log("Error playing alarm:", error);
          }
        }

        shareCountdown() {
          const timeRemaining = this.targetDate - new Date();
          const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
          );

          let timeText = "";
          if (days > 0) {
            timeText = `${days} day${days !== 1 ? "s" : ""}`;
            if (hours > 0)
              timeText += ` and ${hours} hour${hours !== 1 ? "s" : ""}`;
          } else if (hours > 0) {
            timeText = `${hours} hour${hours !== 1 ? "s" : ""}`;
          } else {
            const minutes = Math.floor(
              (timeRemaining % (1000 * 60 * 60)) / (1000 * 60),
            );
            timeText = `${minutes} minute${minutes !== 1 ? "s" : ""}`;
          }

          const share = new TickleboxShare({
            title: "Countdown Timer - TickleBox",
            text: `‚è∞ I'm counting down ${timeText} until "${this.eventName}" on TickleBox! Join me in the excitement!`,
            url: window.location.href,
          });
          share.openModal();
        }

        shareCompletion() {
          const share = new TickleboxShare({
            title: "Countdown Timer - TickleBox",
            text: `üéâ The countdown for "${this.eventName}" is complete! The celebration has begun on TickleBox!`,
            url: window.location.href,
          });
          share.openModal();
        }

        shareToPlatform(platform) {
          const shareUrl = encodeURIComponent(window.location.href);
          const shareText = encodeURIComponent(
            `I'm counting down to "${this.eventName}" on TickleBox! Join me! ‚è∞`,
          );

          let url = "";

          switch (platform) {
            case "facebook":
              url = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
              break;
            case "twitter":
              url = `https://twitter.com/intent/tweet?url=${shareUrl}&text=${shareText}`;
              break;
            case "whatsapp":
              url = `https://wa.me/?text=${shareText}%20${shareUrl}`;
              break;
            case "copy":
              navigator.clipboard.writeText(window.location.href);
              alert("Link copied to clipboard!");
              return;
          }

          if (url) {
            window.open(url, "_blank", "width=600,height=400");
          }
        }
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", () => {
        // Load navbar and footer
        fetch("../components/navbar.html")
          .then((response) => response.text())
          .then((html) => {
            document.getElementById("tickleboxNavbarContainer").innerHTML =
              html;
            if (typeof initTheme === "function") initTheme();
            if (typeof initSearch === "function") initSearch();
            if (typeof initDropdowns === "function") initDropdowns();
            if (typeof initMobileMenu === "function") initMobileMenu();
          });

        fetch("../components/footer.html")
          .then((response) => response.text())
          .then((html) => {
            document.getElementById("tickleboxFooterContainer").innerHTML =
              html;
            if (typeof initFooter === "function") initFooter();
          });

        // Initialize countdown game
        window.tickleboxCountdownGame = new TickleboxCountdownGame();
      });
    </script>
  </body>
</html>
